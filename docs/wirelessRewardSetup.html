

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>FEEDER setup &mdash; openEPhys_DACQ 0.75 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Recording PC setup for Data Processing" href="recordingPCforDataProcessing.html" />
    <link rel="prev" title="Camera and GlobalClock Raspberry Pi setup" href="cameraRPiSetup.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> openEPhys_DACQ
          

          
          </a>

          
            
            
              <div class="version">
                0.75
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="recordingPCandOpenEphysGUI.html">Recording PC setup for Data Acquisition</a></li>
<li class="toctree-l1"><a class="reference internal" href="cameraRPiSetup.html">Camera and GlobalClock Raspberry Pi setup</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">FEEDER setup</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#setting-up-raspberry-pi-zero-software">Setting up Raspberry Pi Zero software</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#installing-raspberry-pi-os-raspbian">Installing Raspberry Pi OS: Raspbian</a></li>
<li class="toctree-l3"><a class="reference internal" href="#install-necessary-software-on-rpi-zero">Install necessary software on RPi Zero</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setting-up-raspberry-pi-zero-interface-with-picon-zero-on-milk-feeder-only">Setting up Raspberry Pi Zero interface with Picon Zero on Milk FEEDER only</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#setting-up-raspberry-pi-zero-networking-with-recording-pc">Setting up Raspberry Pi Zero networking with Recording PC</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#setting-up-the-wireless-router">Setting up the wireless router</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setting-up-networking-with-rpi-zero-and-recording-pc">Setting up Networking with RPi Zero and Recording PC</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setting-a-static-ip-address-on-the-rpi-zero">Setting a static IP address on the RPi Zero</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuring-ssh-on-rpi-zero">Configuring SSH on RPi Zero</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#production-and-assembly-of-pellet-feeder">Production and assembly of Pellet FEEDER</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#commerically-available-materials-needed">Commerically available materials needed</a></li>
<li class="toctree-l3"><a class="reference internal" href="#d-printed-elements-to-produce">3D printed elements to produce</a></li>
<li class="toctree-l3"><a class="reference internal" href="#assembly-of-pellet-feeder">Assembly of Pellet FEEDER</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#use-and-maintenance-of-pellet-feeder">Use and Maintenance of Pellet FEEDER</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#use-of-pellet-feeder">Use of Pellet FEEDER</a></li>
<li class="toctree-l3"><a class="reference internal" href="#maintenance-of-pellet-feeder">Maintenance of Pellet FEEDER</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#production-and-assembly-of-milk-feeder">Production and assembly of Milk FEEDER</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="recordingPCforDataProcessing.html">Recording PC setup for Data Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="userManual.html">User Manual</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">openEPhys_DACQ</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>FEEDER setup</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/wirelessRewardSetup.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="feeder-setup">
<span id="wirelessrewardsetup"></span><h1>FEEDER setup<a class="headerlink" href="#feeder-setup" title="Permalink to this headline">¶</a></h1>
<p>FEEDER - Food Ejector Executing Directions Established via Radio
or Wireless Reward Module.</p>
<div class="section" id="setting-up-raspberry-pi-zero-software">
<h2>Setting up Raspberry Pi Zero software<a class="headerlink" href="#setting-up-raspberry-pi-zero-software" title="Permalink to this headline">¶</a></h2>
<p>The software and networking setup described below is identical for Milk FEEDER and Pellet FEEDER, except for sections where said otherwise.</p>
<p>It is advisable to follow through this part first, before assembling the FEEDER. This way it is more convenient to plug the RPi Zero to the power socket, keyboard, mouse and monitor for working through the following steps.</p>
<p>This tutorial is based on setting up <a class="reference external" href="https://www.raspberrypi.org/products/raspberry-pi-zero-w/">Raspberry Pi Zero W</a> with Recording PC that is connected to the same WiFi router as the FEEDERs.</p>
<p>If you are setting up multiple Pi Zeros, you can make copies after you have set up the software and networking on the first one. To make copies of a configured RPi Zero, use this guide: <a class="reference internal" href="cameraRPiSetup.html#duplicatingrpis"><span class="std std-ref">Making copies of Raspberry Pis</span></a>. Ensure to change the static IP information on each new copy and test the SSH connection for each one, as instructed in the guide.</p>
<div class="section" id="installing-raspberry-pi-os-raspbian">
<h3>Installing Raspberry Pi OS: Raspbian<a class="headerlink" href="#installing-raspberry-pi-os-raspbian" title="Permalink to this headline">¶</a></h3>
<p>Download <strong>Raspbian Stretch Lite</strong> (Here used version 4.9) from <a class="reference external" href="https://www.raspberrypi.org/downloads/raspbian/">Raspberry website</a>. Unpack the downloaded <em>.zip</em> file with <code class="docutils literal notranslate"><span class="pre">Archive</span> <span class="pre">Manager</span></code> to get access to the <em>.img</em> file.</p>
<p>Download <strong>Etcher</strong> from this <a class="reference external" href="https://etcher.io/">website</a>. Unpack the downloaded <em>.zip</em> and run (double-click) the Etcher <em>.AppImage</em>. Select the Raspbian <em>.img</em> file and your inserted microSD card. Write the image (<em>Flash</em> button).</p>
<p>Insert the microSD card into Raspberry Pi Zero.</p>
</div>
<div class="section" id="install-necessary-software-on-rpi-zero">
<h3>Install necessary software on RPi Zero<a class="headerlink" href="#install-necessary-software-on-rpi-zero" title="Permalink to this headline">¶</a></h3>
<p>Connect your Raspberry Pi Zero W with a keyboard, monitor and power socket. Note, RPi Zero has no regular USB output, therefore you will need to use an adaptor to connect the keyboard. You will also need a mini HDMI to HDMI adaptor to connect your monitor.</p>
<p>The default account on a freshly installed Raspbian OS is username <code class="docutils literal notranslate"><span class="pre">pi</span></code> with password <code class="docutils literal notranslate"><span class="pre">raspberry</span></code>.</p>
<p>You need to connect your RPi Zero to the internet to install the necessary software. This can be done using a Wi-Fi connection, for example, a Wi-Fi hotspot created by your laptop or smartphone.</p>
<p>Raspbian Lite version has only command line interface and no ethernet cable port. Therefore you will need to manually edit <code class="docutils literal notranslate"><span class="pre">/etc/wpa_supplicant/wpa_supplicant.conf</span></code> using the command <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">nano</span> <span class="pre">/etc/wpa_supplicant/wpa_supplicant.conf</span></code>. Enter your WiFi details such that the <code class="docutils literal notranslate"><span class="pre">wpa_supplicant.conf</span></code> file would look something like this:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>country=GB
ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
update_config=1

network={
        ssid=&quot;r418&quot;
        psk=&quot;myPasswordIsSafe&quot;
}
</pre></div>
</div>
<p>Here <code class="docutils literal notranslate"><span class="pre">ssid</span></code> is the name of the wireless network as it would appear in the list of available WiFi devices, in this case <code class="docutils literal notranslate"><span class="pre">r418</span></code>. The <code class="docutils literal notranslate"><span class="pre">psk</span></code> is the access password for the wireless network, in this case <code class="docutils literal notranslate"><span class="pre">myPasswordIsSafe</span></code>.</p>
<p>To save and exit with the  <code class="docutils literal notranslate"><span class="pre">nano</span></code> file editor, press <code class="docutils literal notranslate"><span class="pre">Ctrl</span> <span class="pre">+</span> <span class="pre">X</span></code> and type <code class="docutils literal notranslate"><span class="pre">Y</span></code> to confirm save and press <code class="docutils literal notranslate"><span class="pre">Enter</span></code> to save to the same file you started to edit.</p>
<p>Reboot the RPi Zero Zero using command <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">reboot</span></code>.</p>
<p>To update the RPi Zero software with the following terminal commands:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo apt-get update        # Fetches the list of available updates
sudo apt-get upgrade       # Strictly upgrades the current packages
sudo apt-get dist-upgrade  # Installs updates (new ones)
</pre></div>
</div>
<p>To install ZeroMQ use the following terminal commands, as copied from <a class="reference external" href="https://github.com/MonsieurV/ZeroMQ-RPi">https://github.com/MonsieurV/ZeroMQ-RPi</a></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo apt-get install libtool pkg-config build-essential autoconf automake python-pip
wget https://github.com/jedisct1/libsodium/releases/download/1.0.3/libsodium-1.0.3.tar.gz
tar -zxvf libsodium-1.0.3.tar.gz
cd libsodium-1.0.3/
./configure
make
sudo make install
cd ~/
wget http://download.zeromq.org/zeromq-4.1.3.tar.gz
tar -zxvf zeromq-4.1.3.tar.gz
cd zeromq-4.1.3/
./configure
make
sudo make install
sudo ldconfig
sudo apt-get install python-dev
sudo pip install pyzmq
cd ~/
</pre></div>
</div>
<p>Finally, you need to put the scripts for controlling the feeders onto the RPi Zero. You could copy them over with a USB stick, download them from github or transfer them later using the <code class="docutils literal notranslate"><span class="pre">scp</span></code> command. In any case, you need to put the following files from the openEphys_DACQ github to the RPi home directory at <code class="docutils literal notranslate"><span class="pre">/home/pi/</span></code>:</p>
<ul class="simple">
<li><dl class="simple">
<dt>Pellet FEEDER</dt><dd><ul>
<li><p>ZMQcomms.py</p></li>
<li><p>pelletFeederController.py</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Milk FEEDER</dt><dd><ul>
<li><p>ZMQcomms.py</p></li>
<li><p>audioSignalGenerator.py</p></li>
<li><p>milkFeederController.py</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="setting-up-raspberry-pi-zero-interface-with-picon-zero-on-milk-feeder-only">
<h3>Setting up Raspberry Pi Zero interface with Picon Zero on Milk FEEDER only<a class="headerlink" href="#setting-up-raspberry-pi-zero-interface-with-picon-zero-on-milk-feeder-only" title="Permalink to this headline">¶</a></h3>
<p>I2C module needs to be enabled in RPi settings for use of Picon Zero in the Milk FEEDER. You can do this by accessing RPi settings via terminal command <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">raspi-config</span></code> and choosing <em>Interfacing Options</em> with arrow keys and pressing Enter. Select <em>I2C</em> option and choose to <em>Enable</em> it. Reboot the RPi.</p>
<p>Install the necessary libraries for working with the Picon Zero controller with the following terminal commands:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo apt-get install python-smbus python3-smbus python-dev python3-dev
wget -q http://4tronix.co.uk/piconzero/piconzero.py -O piconzero.py
# Ensure piconzero.py remains in Pi root directory ``/home/pi/`` as it is used by controller scripts.
</pre></div>
</div>
<p>You will need to edit the file <code class="docutils literal notranslate"><span class="pre">/boot/config.txt</span></code>. Do this with terminal command <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">nano</span> <span class="pre">/boot/config.txt</span></code> and add the following lines to the end of this file:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>dtparam=i2c1=on
dtparam=i2c_arm=on
</pre></div>
</div>
<p>Save the file and reboot the RPi Zero.</p>
<p>If you have assembled the RPi Zero with Picon Zero, you are able to test if everything is running smoothly by entering terminal command <code class="docutils literal notranslate"><span class="pre">i2cdetect</span> <span class="pre">-y</span> <span class="pre">1</span></code>. You should see an output table with empty values everywhere but one element, which should say <code class="docutils literal notranslate"><span class="pre">22</span></code>.</p>
</div>
</div>
<div class="section" id="setting-up-raspberry-pi-zero-networking-with-recording-pc">
<h2>Setting up Raspberry Pi Zero networking with Recording PC<a class="headerlink" href="#setting-up-raspberry-pi-zero-networking-with-recording-pc" title="Permalink to this headline">¶</a></h2>
<p>To connect the Recording PC wirelessly to the FEEDERs, use a wireless router. The Recording PC networking for external network is set up using the guide <a class="reference internal" href="recordingPCandOpenEphysGUI.html#recpcnetworkinterfaces"><span class="std std-ref">Connect to the local network</span></a> and the internal networking necessary for tracking Raspberry Pis is set up using the guide  <a class="reference internal" href="cameraRPiSetup.html#recpcnetworkinterfacesforinternalnetwork"><span class="std std-ref">Configuring the Recording PC networking with Raspberry Pis</span></a>. We add a standard WiFi router (<a class="reference external" href="http://www.tp-link.com/uk/products/details/cat-9_TL-WR841N.html">TL-WR841N</a>) with ethernet LAN ports to the network by connecting the network switch between Recording PC and tracking RPis to one of the ethernet LAN ports on the wireless router.</p>
<p>Note that for the devices to see each other, the IP addresses added to the devices in the internal network must all have the same values, apart from the last digits after the last separator, e.g. <code class="docutils literal notranslate"><span class="pre">192.168.0.1</span></code> and <code class="docutils literal notranslate"><span class="pre">192.168.0.22</span></code>. We chose the <code class="docutils literal notranslate"><span class="pre">192.168.0.xx</span></code> address as it did not match the external network IP and made it easiest to work with a WiFi router, for which the default IP address was <code class="docutils literal notranslate"><span class="pre">192.168.0.1</span></code>.</p>
<div class="section" id="setting-up-the-wireless-router">
<h3>Setting up the wireless router<a class="headerlink" href="#setting-up-the-wireless-router" title="Permalink to this headline">¶</a></h3>
<p>The TL-WR841N wireless router configuration page can be accessed using a browser from a connected device (LAN or WiFi) and typing in the address bar <code class="docutils literal notranslate"><span class="pre">192.168.0.1</span></code>. The username and password are both <code class="docutils literal notranslate"><span class="pre">admin</span></code>.</p>
<p>We changed the <em>Wireless Network Name</em> or <code class="docutils literal notranslate"><span class="pre">SSID</span></code> in <em>Wireless</em> -&gt; <em>Wireless Settings</em> to <code class="docutils literal notranslate"><span class="pre">r418</span></code>. For the <em>Wireless Security</em> we chose <em>WPA/WPA2 - Personal</em> version <em>WPA2-PSK</em> encryption <em>AES</em> and set the Wireless password to our liking.</p>
<p>We also changed the <em>DHCP</em> -&gt; <em>DHCP Settings</em>, although this may not be relevant. <em>Start IP Address</em> to <code class="docutils literal notranslate"><span class="pre">192.168.0.1</span></code> and <em>End IP Address</em> to <code class="docutils literal notranslate"><span class="pre">192.168.0.99</span></code>.</p>
<p>Make sure to save any changes and reboot the router.</p>
</div>
<div class="section" id="setting-up-networking-with-rpi-zero-and-recording-pc">
<h3>Setting up Networking with RPi Zero and Recording PC<a class="headerlink" href="#setting-up-networking-with-rpi-zero-and-recording-pc" title="Permalink to this headline">¶</a></h3>
<p>Now connect the RPi Zero to the wireless router by changing the file <code class="docutils literal notranslate"><span class="pre">/etc/wpa_supplicant/wpa_supplicant.conf</span></code> as instructed above, for connecting RPi Zero to WiFi with internet.</p>
</div>
<div class="section" id="setting-a-static-ip-address-on-the-rpi-zero">
<h3>Setting a static IP address on the RPi Zero<a class="headerlink" href="#setting-a-static-ip-address-on-the-rpi-zero" title="Permalink to this headline">¶</a></h3>
<p>The following instructions are based on this <a class="reference external" href="https://www.youtube.com/watch?v=r3UIQXn8Zp0">video guide</a>.</p>
<p>To set static IP address, you need to make changes to <code class="docutils literal notranslate"><span class="pre">/etc/dhcpcd.conf</span></code>. For that you need to clarify the identity of the correct wireless device on your RPi Zero. Enter into terminal <code class="docutils literal notranslate"><span class="pre">ifconfig</span></code> and you should see network identities. It is most likely <code class="docutils literal notranslate"><span class="pre">wlan0</span></code> that has inforamtion such as <code class="docutils literal notranslate"><span class="pre">Link</span> <span class="pre">encap:Ethernet</span></code>. You also need the IP address of the Wi-Fi router. This is the IP address you typed into your browser to find access the router’s graphical interface. Alternatively, you can find the router’s IP by entering the terminal command <code class="docutils literal notranslate"><span class="pre">ip</span> <span class="pre">route</span> <span class="pre">show</span></code>. This should output information on your current connection and should show the Wi-Fi hotspot IP address as something like: <code class="docutils literal notranslate"><span class="pre">default</span> <span class="pre">via</span> <span class="pre">192.168.0.1</span></code>.</p>
<p>Now open <code class="docutils literal notranslate"><span class="pre">dhcpcd.conf</span></code> with terminal command <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">nano</span> <span class="pre">/etc/dhcpcd.conf</span></code>. Add to the very end of the file the following lines:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>interface wlan0

static ip_address=192.168.0.40/24
static routers=192.168.0.1
static domain_name_servers=192.168.0.1
</pre></div>
</div>
<p>Here you want to use the correct device identity that you found on the RPi Zero with <code class="docutils literal notranslate"><span class="pre">ifconfig</span></code> command, e.g. <code class="docutils literal notranslate"><span class="pre">wlan0</span></code>. Set the <code class="docutils literal notranslate"><span class="pre">router</span></code> and <code class="docutils literal notranslate"><span class="pre">domain_name_server</span></code> values to the IP of the router that you found. Finally, the <code class="docutils literal notranslate"><span class="pre">ip_address</span></code> should be the same as the router, only the final value should be different, as in this example it is <code class="docutils literal notranslate"><span class="pre">40</span></code>. If you have multipe RPi Zeros, set this to different value on each, e.g. 40, 41, 42 etc. The <code class="docutils literal notranslate"><span class="pre">/24</span></code> indicates the port number. Keep this the same in all cases.</p>
<p>We used the final IP address values 40 and up for Milk FEEDERs 1, 2, 3 etc and IP address values 60 and up for Pellet FEEDERs 1, 2, 3 etc.</p>
<p>As you save the changes to <code class="docutils literal notranslate"><span class="pre">dhcpcd.conf</span></code> and reboot your RPi Zero, it should connect to the Wi-Fi hotspot automatically and have the IP address you assigned. You can check this now with the <code class="docutils literal notranslate"><span class="pre">ifconfig</span></code> terminal command on the RPi Zero and check if you see the IP address you assigned. Also try pinging the router by using it’s IP in the command <code class="docutils literal notranslate"><span class="pre">ping</span> <span class="pre">192.168.0.1</span></code>.</p>
</div>
<div class="section" id="configuring-ssh-on-rpi-zero">
<h3>Configuring SSH on RPi Zero<a class="headerlink" href="#configuring-ssh-on-rpi-zero" title="Permalink to this headline">¶</a></h3>
<p>SSH needs to be enabled on RPi Zero. You can do this by accessing RPi settings via terminal command <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">raspi-config</span></code> and choosing <em>Interfacing Options</em> with arrow keys and pressing Enter. Select <em>SSH</em> option and choose to <em>Enable</em> it. Restart RPi Zero.</p>
<p>Try connecting to the RPi Zero with SSH using terminal command from Recording PC <code class="docutils literal notranslate"><span class="pre">ssh</span> <span class="pre">pi&#64;192.168.0.40</span></code>. At first time of running, it may say <em>The authenticity of host ‘192.168.0.40 (192.168.0.40)’ can’t be established. -//- Are you sure you want to continue connecting (yes/no)?*</em> Type <strong>yes</strong> and hit Enter.</p>
<p>The SSH login may be slow. This can be fixed by editing the <code class="docutils literal notranslate"><span class="pre">sshd_config</span></code> file. Open it with terminal command <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">nano</span> <span class="pre">/etc/ssh/sshd_config</span></code> and add this line to the very end:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>UseDNS no
</pre></div>
</div>
<p>Restart the RPi Zero</p>
<p>The following instructions allow connecting with the RPi via SSH without entering password each time. This is necessary for scripts on Recording PC. The instructions are based on <a class="reference external" href="https://www.raspberrypi.org/documentation/remote-access/ssh/passwordless.md">this guide</a>. If you have previously generated the SSH key on the Recording PC, you should skip the first step of generating a new key.</p>
<p>Generate a new SSH key on Recording PC with terminal command <code class="docutils literal notranslate"><span class="pre">ssh-keygen</span> <span class="pre">-t</span> <span class="pre">rsa</span> <span class="pre">-C</span> <span class="pre">recpc&#64;pi</span></code>. Use the default location to save the key by pressing Enter. Leave the passphrase empty by pressing Enter. You have now generated a new SSH key.</p>
<p>To copy the SSH key to the RPi open terminal on Recording PC and connect to your RPi using SSH with command <code class="docutils literal notranslate"><span class="pre">ssh</span> <span class="pre">pi&#64;192.168.0.40</span></code> and enter <code class="docutils literal notranslate"><span class="pre">raspberry</span></code> as password. Enter this command in the terminal where you opened the SSH connection <code class="docutils literal notranslate"><span class="pre">install</span> <span class="pre">-d</span> <span class="pre">-m</span> <span class="pre">700</span> <span class="pre">~/.ssh</span></code>.</p>
<p>Now exit the SSH session or open a new terminal on Recording PC and enter this command <code class="docutils literal notranslate"><span class="pre">cat</span> <span class="pre">~/.ssh/id_rsa.pub</span> <span class="pre">|</span> <span class="pre">ssh</span> <span class="pre">pi&#64;192.168.0.40</span> <span class="pre">'cat</span> <span class="pre">&gt;&gt;</span> <span class="pre">.ssh/authorized_keys'</span></code>. Use the correct IP address (the numbers: <code class="docutils literal notranslate"><span class="pre">192.168.0.40</span></code>) in that command for the IP address of the RPi you are connecting to. Enter the password <code class="docutils literal notranslate"><span class="pre">raspberry</span></code> for your RPi.</p>
<p>Now your RPi should be able to connect to the RPi via SSH without a password. Test if it requests for password when you try to conenct to it using SSH.</p>
<p>Now the RPi Zero software and networking is fully configured and after assembling the FEEDER, it will be ready to use with the Recording PC.</p>
</div>
</div>
<div class="section" id="production-and-assembly-of-pellet-feeder">
<h2>Production and assembly of Pellet FEEDER<a class="headerlink" href="#production-and-assembly-of-pellet-feeder" title="Permalink to this headline">¶</a></h2>
<p>This guide describes the commercial and 3D printed parts needed as well as the assembly of the Pellet FEEDER. See below for illustrative images.</p>
<p>The working principle of the Pellet FEEDER is that it only ever picks up at most a single pellet to drop, as no more fit into the transfer mechanism. Occasionally no pellet is caught, in which case the IR detector does not detect a pellet and the FEEDER tries again.</p>
<p>The functioning of the Pellet FEEDER with this exact design is dependent on using dry pellets of specific size, that produce minimal dust. We have been using Dustless Precision Pellets®, Rodent, Purified, 20mg from <a class="reference external" href="http://www.bio-serv.com/product/DPP_RP.html">Bio-Serv</a>. The design of the holes in feeder elements (<strong>RotatingElement</strong> and <strong>Detector</strong>) is based on fitting exactly one pellet at a time. If pellet size is changed, these elements need to be redesigned.</p>
<img alt="_images/PelletFeederFig1.jpg" src="_images/PelletFeederFig1.jpg" />
<div class="section" id="commerically-available-materials-needed">
<h3>Commerically available materials needed<a class="headerlink" href="#commerically-available-materials-needed" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><dl class="simple">
<dt><a class="reference external" href="https://www.raspberrypi.org/products/raspberry-pi-zero-w/">Raspberry Pi Zero W</a></dt><dd><ul>
<li><p>microSD card to use with the Pi Zero</p></li>
</ul>
</dd>
</dl>
</li>
<li><p><a class="reference external" href="https://shop.pimoroni.com/products/pibow-zero-w">Raspberry Pi Zero Case</a></p></li>
<li><p><a class="reference external" href="https://shop.pimoroni.com/products/ir-break-beam-sensor-5mm-leds">IR Break Beam Sensor (5mm LEDs)</a></p></li>
<li><dl class="simple">
<dt><a class="reference external" href="https://www.robotbirds.co.uk/default/towerpro-sg5010-standard-size-servos.html">TowerPro 44g SG-5010 Analogue Servo</a></dt><dd><ul>
<li><p>Digital Servo of the same type and slightly different versions may work as well, however it this specific servo comes with output discs that fit the 3D print designs perfectly.</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Standard wires and soldering kit</p></li>
<li><p>Thick adhesive, such as dental cement or epoxy.</p></li>
<li><p>Superglue</p></li>
<li><p>Power drill</p></li>
<li><p>Dustless Precision Pellets®, Rodent, Purified, 20mg from <a class="reference external" href="http://www.bio-serv.com/product/DPP_RP.html">Bio-Serv</a></p></li>
</ul>
</div>
<div class="section" id="d-printed-elements-to-produce">
<h3>3D printed elements to produce<a class="headerlink" href="#d-printed-elements-to-produce" title="Permalink to this headline">¶</a></h3>
<p>The following files are provided in <code class="docutils literal notranslate"><span class="pre">3D_Printing_Models</span></code> subfolder <code class="docutils literal notranslate"><span class="pre">Pellet_FEEDER</span></code> in both SKP (SketchUp 3D) and STL (generic) formats. Here is a list of items necessary to be printed and their recommended priting settings on Ultimaker 2.</p>
<ul class="simple">
<li><dl class="simple">
<dt>Elements essential for assemply of the FEEDER</dt><dd><ul>
<li><p><strong>TopElement</strong> - Layer Height 0.1 mm, Infill Density 30%</p></li>
<li><p><strong>RotatingElement</strong> - Layer Height 0.1 mm, Infill Density 100%</p></li>
<li><p><strong>BottomElement</strong> - Layer Height 0.1 mm, Infill Density 30%</p></li>
<li><p><strong>Detector</strong> - Layer Height 0.1 mm, Infill Density 50%</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Additional optional elements for combining FEEDER with specific experimental environment</dt><dd><ul>
<li><p><strong>Holders</strong> - Layer Height 0.1 mm, Infill Density 30%</p></li>
<li><p><strong>Guides</strong> - Layer Height 0.1 mm, Infill Density 30%</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>The essential elements and how they are to be assembled relative to each other is illustrated in the image below.</p>
<img alt="_images/PelletFeederFig2.jpg" src="_images/PelletFeederFig2.jpg" />
</div>
<div class="section" id="assembly-of-pellet-feeder">
<h3>Assembly of Pellet FEEDER<a class="headerlink" href="#assembly-of-pellet-feeder" title="Permalink to this headline">¶</a></h3>
<p>First step would be to wire together all the electronics. This could be made easier with a Raspberry Pi GPIO header, such as <a class="reference external" href="https://shop.pimoroni.com/products/gpio-hammer-header?variant=35643241098">this</a> and some jumper wires. But teh wires can just be soldered directly to the Pi’s GPIO contacts.</p>
<p>The below table describes the wiring using <a class="reference external" href="https://pinout.xyz/">Physical Numbering of RPi GPIO contacts</a>.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 39%" />
<col style="width: 18%" />
<col style="width: 44%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Element</p></th>
<th class="head"><p>Wire type</p></th>
<th class="head"><p>Raspberry Pi Physical Pin</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td rowspan="3"><p>TowerPro SG-5010 wires</p></td>
<td><p>ground</p></td>
<td><p>6</p></td>
</tr>
<tr class="row-odd"><td><p>power</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-even"><td><p>signal</p></td>
<td><p>12</p></td>
</tr>
<tr class="row-odd"><td rowspan="2"><p>IR Break Beam Sensor</p>
<p>Emitter</p>
</td>
<td><p>ground</p></td>
<td><p>9</p></td>
</tr>
<tr class="row-even"><td><p>power</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-odd"><td rowspan="3"><p>IR Break Beam Sensor</p>
<p>Detector</p>
</td>
<td><p>ground</p></td>
<td><p>9</p></td>
</tr>
<tr class="row-even"><td><p>power</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-odd"><td><p>signal</p></td>
<td><p>15</p></td>
</tr>
</tbody>
</table>
<p>This wiring could be changed, but if the GPIO pins of signal wires are changed, corresponding changes would need to be made in <code class="docutils literal notranslate"><span class="pre">pelletFeederController.py</span></code>.</p>
<p>At this stage it is recommended to test if everything is working as expected using the <code class="docutils literal notranslate"><span class="pre">detect_pellet</span></code> and <code class="docutils literal notranslate"><span class="pre">servo_controller</span></code> classes in <code class="docutils literal notranslate"><span class="pre">pelletFeederController.py</span></code>.</p>
<p>To assemble the 3D printed elements, first glue (with superglue or thin layer of epoxy) to the bottom of the <strong>RotatingElement</strong> the output disc of the servo motor that fits there perfectly. If there is any wiggle room, make sure the disc is in the center of the <strong>RotatingElement</strong>.</p>
<p>Then glue (with superglue or thin layer of epoxy) the <strong>BottomElement</strong> to the top of the servo motor. Make sure to get the location of the pellet drop opening correct based on the illustrations above. The pellet drop opening (largest gap on the perimeter of <strong>BottomElement</strong>, to which <strong>Detector</strong> can be attached) should be as far away from the servo motor as possible. To assist with the glueing the <strong>RotatingElement</strong> can be attached firmly to the servo motor with the rotating disc.</p>
<p>It is important that there is almost no space between the <strong>RotatingElement</strong> and <strong>BottomElement</strong>, as seen through the hole in the <strong>RotatingElement</strong>.</p>
<p>Once the <strong>BottomElement</strong> glue has hardened, attach the <strong>RotatingElement</strong> to the servo motor such that the when the <code class="docutils literal notranslate"><span class="pre">servo_controller</span></code> class in <code class="docutils literal notranslate"><span class="pre">pelletFeederController.py</span></code> sets the angle to <code class="docutils literal notranslate"><span class="pre">ReleaseAngle</span></code> (default is 90), then the hole in the <strong>RotatingElement</strong> would be aligned with the pellet drop opening on the <strong>BottomElement</strong>. Then place the <strong>TopElement</strong> on top of the <strong>RotatingElement</strong> inside the <strong>BottomElement</strong> such that when <code class="docutils literal notranslate"><span class="pre">servo_controller</span></code> class in <code class="docutils literal notranslate"><span class="pre">pelletFeederController.py</span></code> sets the angle to <code class="docutils literal notranslate"><span class="pre">LoadingAngle</span></code> (default is 30), the hole in the <strong>RotatingElement</strong> is aligned with the gap in the bottom of the <strong>TopElement</strong>. If this is done correctly, the relative positions of all elements should match those on the illustrations.</p>
<p>Once everything is aligned, remember the position of the <strong>TopElement</strong>. Use <code class="docutils literal notranslate"><span class="pre">servo_controller</span></code> class in <code class="docutils literal notranslate"><span class="pre">pelletFeederController.py</span></code> to set the angle of <strong>RotatingElement</strong> such that its hole is between the gaps of <strong>TopElement</strong> and <strong>BottomElement</strong> (usually the value of the angle is around 45). Place a single pellet in the hole of <strong>RotatingElement</strong>, oriented such that its would be as high in the hole as possible (the pellets are not perfectly spherical). Then put a small piece of paper over the hole with the pellet, such that when you put the <strong>TopElement</strong> back to its correct position, the piece of paper is accessible and can be removed via the gap in the bottom of the <strong>TopElement</strong>. This ensures that there is some minimal gap between the pellet and the <strong>TopElement</strong>, in a situation when pellet is taking most space between the <strong>BottomElement</strong> and <strong>TopElement</strong>. Now glue the <strong>TopElement</strong> to the <strong>BottomElement</strong> using a viscuous adhesive between the top edge of the <strong>BottomElement</strong>, taking care not to let any glue get to the inside of the <strong>BottomElement</strong>, where it may glue stuck the <strong>RotatingElement</strong>.</p>
<p>Now it is recommended to test the functioning of the Pellet FEEDER using the <code class="docutils literal notranslate"><span class="pre">release_pellet</span></code> function in <code class="docutils literal notranslate"><span class="pre">pelletFeederController.py</span></code>, which does not use the IR beams to check for false positives. The Pellet FEEDER without the IR beams should release pellets with around 90% success rate. In some cases, the <strong>TopElement</strong> may need to be re-attached to provide a tighter or looser fit on the <strong>RotatingElement</strong>.</p>
<p>The last thing to assemble is the <strong>Detector</strong> and the IR Break Beam Sensor. On the sides of the 3D printed <strong>Detector</strong>, where the IR beam emitter and sensor are supposed to go (see images above), there are indentations with a small hole in the middle. First use a small drill bit, about 1 mm diameter, to drill through the small holes all the way through the <strong>Detector</strong> element. There should be a clear straight hole from one side to the other, going orthogonally through center of the pellet drop hole in the middle of the <strong>Detector</strong>. The IR Break Beam Sensor is going to pass a light through this small hole just made, which is interrupted by a pellet going through. Now use a larger drill bit to make the indentation on the side of the <strong>Detector</strong> deeper, such that it would perfectly fit the emitter and sensor parts of the IR Break Beam Sensor (see images above for how they should fit). The smaller hole carrying the IR beam through the <strong>Detector</strong> may need clearing up afterwards. Then place the IR Break Beam Sensor’s emitter and sensor to either side of the <strong>Detector</strong> (does not matter which one is which side) and glue them in place with a strong adhesive.</p>
<p>The <strong>Detector</strong> can be pushed onto the <strong>BottomElement</strong> and it should simply snap in place.</p>
<p>The Pellet FEEDER is now fully assembled. Make sure to test it.</p>
<p>Any custom holder and pellet guide can be used as long as it can support the FEEDER from the servo motor, allow attaching the Raspberry Pi Zero and provides clear passage from any pellets dropping out from the bottom of the <strong>Detector</strong>. The designs for <strong>Holders</strong> and <strong>Guides</strong> used in our lab are provided. We have glued a rubber tube to the bottom of the <strong>Detector</strong> that guides the pellets as necessary.</p>
</div>
</div>
<div class="section" id="use-and-maintenance-of-pellet-feeder">
<h2>Use and Maintenance of Pellet FEEDER<a class="headerlink" href="#use-and-maintenance-of-pellet-feeder" title="Permalink to this headline">¶</a></h2>
<div class="section" id="use-of-pellet-feeder">
<h3>Use of Pellet FEEDER<a class="headerlink" href="#use-of-pellet-feeder" title="Permalink to this headline">¶</a></h3>
<p>The Pellet FEEDER is controller with <code class="docutils literal notranslate"><span class="pre">pelletFeederController.py</span></code>. Simplest command is to SSH into the Raspberry Pi of the FEEDER and give command <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">pelletFeederController.py</span> <span class="pre">--releasePellet</span> <span class="pre">1</span></code>, which instructs it to release exactly one pellet as detected by the IR Break Beam Sensor.</p>
<p>For faster contol the script should be started without the <code class="docutils literal notranslate"><span class="pre">--releasePellet</span></code> flag, in which case the <code class="docutils literal notranslate"><span class="pre">Controller</span></code> is activated. This expect signals over ZMQ protocol. See <code class="docutils literal notranslate"><span class="pre">Controller</span></code> class for more information.</p>
</div>
<div class="section" id="maintenance-of-pellet-feeder">
<h3>Maintenance of Pellet FEEDER<a class="headerlink" href="#maintenance-of-pellet-feeder" title="Permalink to this headline">¶</a></h3>
<p>The Pellet FEEDER with the correct pellets is very reliable and should release around 500-1000 pellets without jamming. The <code class="docutils literal notranslate"><span class="pre">max_attempts</span></code> variable in <code class="docutils literal notranslate"><span class="pre">pelletFeederController.py</span></code> is used to stop the pellet in case of too many failed attempts, which is an indicator of jamming.</p>
<p>The jamming is usually caused by the inside of the <strong>Detector</strong> getting too dusty and/or moist. This can stop a dropping pellet, which then causes more to get stuck. In case of a jam, just detach the <strong>Detector</strong> from the <strong>BottomElement</strong> and clear out pellets. Use an air duster to clean off any collected dust. If this is done regularly, no jams may occur.</p>
<p>At the time of writing the most used Pellet FEEDERs have dropped around 5000 pellets and still function as good as new.</p>
</div>
</div>
<div class="section" id="production-and-assembly-of-milk-feeder">
<h2>Production and assembly of Milk FEEDER<a class="headerlink" href="#production-and-assembly-of-milk-feeder" title="Permalink to this headline">¶</a></h2>
<p>The materials you need for the FEEDER:</p>
<p>Raspberry Pi Zero
Picon Zero
Current Converter and Battery Guard - HUBOSD eco X Type w/STOSD8 &amp; XT60
LiPo battery with high current output
Solenoid Pinch Valve</p>
<p>Ensure you use the correct motor to match the command in openPinchValve.py, set motor 1.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="recordingPCforDataProcessing.html" class="btn btn-neutral float-right" title="Recording PC setup for Data Processing" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="cameraRPiSetup.html" class="btn btn-neutral float-left" title="Camera and GlobalClock Raspberry Pi setup" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Barry-lab

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>